<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GÖ.AI | Product Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet (map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --bg0:#07090d;
      --bg1:#0b0f14;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.045);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --muted2:rgba(255,255,255,.52);
      --gold:#d3ad3a;
      --gold2:#f1d06a;
      --blue:#9ad7ff;
      --shadow: 0 30px 80px rgba(0,0,0,.55);
      --r:18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 15% 15%, rgba(60,110,180,.20), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(210,160,40,.18), transparent 55%),
        radial-gradient(1200px 900px at 50% 90%, rgba(255,255,255,.05), transparent 60%),
        var(--bg0);
      overflow-x:hidden;
    }

    /* Cinematic “drift” glow */
    .bg-drift{
      position:fixed; inset:-40vh -40vw;
      pointer-events:none;
      filter: blur(40px);
      opacity:.55;
      background:
        radial-gradient(600px 420px at 20% 30%, rgba(120,170,255,.20), transparent 60%),
        radial-gradient(680px 460px at 75% 25%, rgba(255,200,80,.18), transparent 62%),
        radial-gradient(720px 520px at 55% 70%, rgba(255,255,255,.06), transparent 65%);
      animation: drift 14s ease-in-out infinite;
      transform: translate3d(0,0,0);
    }
    @keyframes drift{
      0%{transform: translate3d(-1.5%, -1%, 0) scale(1.02)}
      50%{transform: translate3d(1.8%, 1.2%, 0) scale(1.04)}
      100%{transform: translate3d(-1.5%, -1%, 0) scale(1.02)}
    }

    /* Top nav */
    nav{
      position:sticky; top:0; z-index:60;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:18px 22px;
      background: linear-gradient(to bottom, rgba(7,9,13,.72), rgba(7,9,13,.35));
      border-bottom:1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      letter-spacing:.08em;
      font-weight:650;
      color:rgba(255,255,255,.92);
      user-select:none;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;background:var(--gold);
      box-shadow:0 0 22px rgba(211,173,58,.35);
    }
    .navlinks{
      display:flex; gap:14px; align-items:center;
      font-size:14px;
      color:rgba(255,255,255,.72);
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .navlinks a{
      color:inherit;
      text-decoration:none;
      padding:8px 10px;
      border-radius:10px;
      transition: background .15s ease, color .15s ease, transform .15s ease;
    }
    .navlinks a:hover{
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.90);
      transform: translateY(-1px);
    }
    .navlinks a.active{
      color: rgba(255,255,255,.95);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
    }

    /* Executive dashboard frame */
    .wrap{max-width:1220px;margin:0 auto;padding:0 18px 60px; position:relative;}
    .dashboard-frame{
      margin:26px auto 0;
      border-radius:24px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .dashboard-frame::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 320px at 18% 15%, rgba(211,173,58,.10), transparent 60%),
        radial-gradient(600px 360px at 85% 5%, rgba(120,170,255,.10), transparent 58%),
        radial-gradient(700px 420px at 55% 85%, rgba(255,255,255,.06), transparent 62%);
      opacity:.95;
      pointer-events:none;
      mix-blend-mode: screen;
    }

    /* Dark glass overlay */
    .glass{
      position:relative;
      padding:22px;
      background: rgba(0,0,0,.16);
      backdrop-filter: blur(10px);
    }

    /* Hero */
    .hero{
      padding:40px 14px 8px;
      text-align:center;
      position:relative;
    }
    h1{
      margin:0 0 10px;
      font-size:44px;
      line-height:1.05;
      letter-spacing:-.03em;
      text-shadow: 0 20px 70px rgba(0,0,0,.55);
      opacity:0;
      transform: translateY(10px);
      animation: enter .9s cubic-bezier(.2,.8,.2,1) .05s forwards;
    }
    .sub{
      margin:0 auto 10px;
      max-width:860px;
      color:var(--muted);
      font-size:16px;
      line-height:1.65;
      opacity:0;
      transform: translateY(10px);
      animation: enter .9s cubic-bezier(.2,.8,.2,1) .14s forwards;
    }
    @keyframes enter{to{opacity:1;transform:translateY(0)}}

    /* Grid */
    .grid{
      display:grid;
      grid-template-columns: 1.35fr .95fr;
      gap:18px;
      align-items:start;
      padding: 10px 14px 16px;
      opacity:0;
      transform: translateY(10px);
      animation: enter .9s cubic-bezier(.2,.8,.2,1) .20s forwards;
    }

    @media (max-width: 980px){
      h1{font-size:36px}
      .grid{grid-template-columns:1fr;}
    }

    /* Card (with subtle hover glow + micro animation) */
    .card{
      position:relative;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.065), rgba(255,255,255,.035));
      overflow:hidden;
      transform: translateZ(0);
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
    }
    .card::after{
      content:"";
      position:absolute; inset:-40px;
      background:
        radial-gradient(520px 320px at var(--mx, 50%) var(--my, 50%), rgba(154,215,255,.12), transparent 60%),
        radial-gradient(520px 320px at calc(var(--mx, 50%) + 10%) calc(var(--my, 50%) - 10%), rgba(211,173,58,.10), transparent 62%);
      opacity:0;
      transition: opacity .22s ease;
      pointer-events:none;
      filter: blur(10px);
      mix-blend-mode: screen;
    }
    .card:hover{
      transform: translateY(-2px);
      border-color: rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
    }
    .card:hover::after{opacity:1}

    .card-inner{position:relative; padding:18px;}
    .kicker{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      color: rgba(255,255,255,.72);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      margin-bottom:10px;
    }

    .title-row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom:6px;
    }
    h2{
      margin:0;
      font-size:18px;
      letter-spacing:-.01em;
      color: rgba(255,255,255,.92);
    }
    p{
      margin:0;
      color: var(--muted);
      line-height:1.65;
      font-size:14px;
    }

    /* Form controls */
    .form{
      display:grid;
      gap:12px;
      margin-top:14px;
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 720px){
      .row{grid-template-columns:1fr;}
    }
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.92);
      outline:none;
      font-size:14px;
      transition: border-color .15s ease, background .15s ease, transform .12s ease;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(154,215,255,.30);
      background: rgba(0,0,0,.26);
    }
    input::placeholder, textarea::placeholder{color: rgba(255,255,255,.42);}

    /* Buttons */
    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-top:2px;
    }
    button, .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:10px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      text-decoration:none;
      font-weight:650;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease, filter .12s ease;
      user-select:none;
    }
    button:hover, .btn:hover{
      transform: translateY(-1px);
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.14);
      filter: saturate(1.05);
    }
    .btn-primary{
      background: linear-gradient(180deg, rgba(241,208,106,.95), rgba(211,173,58,.95));
      color: rgba(0,0,0,.88);
      border-color: rgba(241,208,106,.35);
      box-shadow: 0 16px 50px rgba(211,173,58,.22);
    }

    /* Module “coming soon” */
    .soon{
      margin-top:12px;
      padding:12px 12px;
      border-radius:14px;
      border:1px dashed rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: rgba(255,255,255,.72);
      font-size:13px;
      line-height:1.5;
    }
    .soon strong{color: rgba(255,255,255,.90)}
    .pillrow{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;
    }
    .pill{
      font-size:12px;
      color: rgba(255,255,255,.72);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      padding:6px 10px;
      border-radius:999px;
    }

    /* Sentinel UI */
    .sentinel-grid{
      display:grid;
      grid-template-columns: .95fr 1.05fr;
      gap:14px;
      margin-top:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .sentinel-grid{grid-template-columns:1fr;}
    }

    .panel{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
    }
    .panel-h{
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .panel-h .label{
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,.62);
    }
    .panel-b{padding:12px;}

    /* Risk dial */
    .dialWrap{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px;
    }
    .dial{
      width:130px;height:130px;border-radius:999px;
      position:relative;
      display:grid;
      place-items:center;
      background:
        radial-gradient(circle at 50% 50%, rgba(0,0,0,.35) 0 58%, transparent 59%),
        conic-gradient(var(--dialColor, #4caf50) 0 var(--dialPct, 0%), rgba(255,255,255,.10) var(--dialPct, 0%) 100%);
      box-shadow: 0 0 42px rgba(0,0,0,.55);
      transition: filter .25s ease, transform .25s ease;
    }
    .dial::after{
      content:"";
      position:absolute; inset:-18px;
      border-radius:999px;
      background: radial-gradient(120px 120px at 50% 50%, rgba(154,215,255,.10), transparent 60%),
                  radial-gradient(120px 120px at 50% 50%, rgba(211,173,58,.10), transparent 62%);
      filter: blur(10px);
      opacity:.8;
      pointer-events:none;
    }
    .dialVal{
      font-size:34px;
      font-weight:800;
      color: rgba(255,255,255,.92);
      text-shadow: 0 12px 40px rgba(0,0,0,.6);
    }
    .dialMeta{
      flex:1;
      display:grid;
      gap:8px;
      align-content:start;
    }
    .tier{
      font-weight:800;
      letter-spacing:.02em;
    }
    .brief{
      color: rgba(255,255,255,.78);
      font-size:13px;
      line-height:1.55;
    }
    .facts{
      display:grid;
      gap:6px;
      margin-top:2px;
    }
    .fact{
      font-size:12px;
      color: rgba(255,255,255,.62);
    }
    .fact b{color: rgba(255,255,255,.86)}

    /* Map */
    #map{
      width:100%;
      height:320px;
      border-radius:0 0 16px 16px;
    }
    .mapWrap{
      overflow:hidden;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
    }

    /* Leaflet control rounding */
    .leaflet-control-zoom a{
      border-radius:10px !important;
      overflow:hidden;
    }

    /* Telemetry */
    .telemetry{
      display:grid;
      gap:10px;
    }
    .track{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(154,215,255,.9), rgba(241,208,106,.9));
      transition: width .25s ease;
    }
    .telemetryRow{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      color: rgba(255,255,255,.70);
      font-size:12px;
    }
    .telemetryRow .tag{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
    }

    /* Lifecycle buttons */
    .lifecycle{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:8px;
    }
    .lifeBtn{
      padding:9px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color: rgba(255,255,255,.86);
      font-weight:700;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .lifeBtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.14);}
    .lifeBtn.active{
      background: rgba(241,208,106,.14);
      border-color: rgba(241,208,106,.26);
      color: rgba(255,255,255,.92);
    }

    /* T-24 briefing toggle */
    .toggleRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid rgba(255,255,255,.08);
    }
    .toggleRow .muted{color: rgba(255,255,255,.62); font-size:12px;}
    .switch{
      position:relative; width:46px; height:26px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.08);
      cursor:pointer;
      transition: background .15s ease, border-color .15s ease;
    }
    .knob{
      position:absolute; top:3px; left:3px;
      width:20px; height:20px; border-radius:999px;
      background: rgba(255,255,255,.85);
      transition: transform .15s ease;
    }
    .switch.on{
      background: rgba(241,208,106,.22);
      border-color: rgba(241,208,106,.35);
    }
    .switch.on .knob{transform: translateX(20px);}

    /* ===== UPDATED (TSA live UI) ===== */
    #tsaOutput{
      margin-top:14px;
    }

    /* ===== Tier Selector output (Module 04) ===== */
    .tierOutput{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      overflow:hidden;
    }

    .tierOutHead{
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }

    .tierOutHead .label{
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,.62);
    }

    .tierOutBody{
      padding:12px;
      display:grid;
      gap:10px;
    }

    .tierHero{
      display:flex;
      gap:12px;
      align-items:flex-start;
    }

    .tierImg{
      width:86px;
      height:86px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      overflow:hidden;
      flex:0 0 auto;
      display:grid;
      place-items:center;
    }

    .tierImg img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .tierTitle{
      font-weight:850;
      letter-spacing:.01em;
      font-size:16px;
    }

    .tierSub{
      color: rgba(255,255,255,.72);
      font-size:13px;
      line-height:1.55;
      margin-top:3px;
    }

    .tierBadges{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:6px;
    }

    .badge{
      font-size:12px;
      color: rgba(255,255,255,.74);
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      padding:6px 10px;
      border-radius:999px;
    }

    .badge.gold{
      border-color: rgba(241,208,106,.22);
      background: rgba(241,208,106,.10);
      color: rgba(255,255,255,.88);
    }

    .altRow{
      margin-top:2px;
      padding-top:10px;
      border-top:1px solid rgba(255,255,255,.08);
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      color: rgba(255,255,255,.70);
      font-size:12px;
    }

    .altRow b{ color: rgba(255,255,255,.88); }

    footer{
      padding:18px 0 10px;
      color: rgba(255,255,255,.45);
      font-size:12px;
      text-align:center;
    }
    footer a{color: rgba(255,255,255,.72); text-decoration:none; border-bottom:1px solid rgba(255,255,255,.18)}
    footer a:hover{border-bottom-color: rgba(241,208,106,.45); color: rgba(255,255,255,.92)}
  </style>
</head>

<body>
  <div class="bg-drift"></div>

  <nav>
    <div class="brand"><span class="dot"></span> GÖ.AI</div>
    <div class="navlinks">
      <a href="/">Home</a>
      <a class="active" href="/product-demo.html">Product Demo</a>
      <a href="/get-access.html">Get Access</a>
    </div>
  </nav>

  <div class="wrap">
    <div class="dashboard-frame">
      <div class="glass">
        <section class="hero">
          <h1>Interactive Product Demo</h1>
          <p class="sub">
            Explore the intelligence layer behind GÖ.AI. This preview demonstrates how Sentinel™ evaluates trip risk,
            simulates telemetry, and triggers geofence awareness.
          </p>
        </section>

        <section class="grid">
          <!-- LEFT: Sentinel (fully interactive) -->
          <div class="card" id="sentinelCard">
            <div class="card-inner">
              <div class="kicker">SENTINEL • Risk + Geofence • Live Demo</div>
              <div class="title-row">
                <div>
                  <h2>Sentinel™ Risk Engine</h2>
                  <p>Enter a ZIP code to compute a score, render a risk dial, and place a geofence on the map.</p>
                </div>
              </div>

              <div class="form">
                <div class="row">
                  <input type="text" id="zipInput" placeholder="ZIP (e.g., 28202)" maxlength="5" />
                  <select id="radiusSelect" title="Geofence radius">
                    <option value="800">Geofence: 0.5 mi</option>
                    <option value="1600" selected>Geofence: 1 mi</option>
                    <option value="3200">Geofence: 2 mi</option>
                  </select>
                </div>

                <div class="actions">
                  <button class="btn btn-primary" id="analyzeBtn" type="button">Analyze Risk</button>
                  <button class="btn" id="simCreated" type="button">Simulate: Created</button>
                  <button class="btn" id="simEnRoute" type="button">Simulate: En Route</button>
                  <button class="btn" id="simComplete" type="button">Simulate: Complete</button>
                </div>
              </div>

              <div class="sentinel-grid">
                <!-- Left panel: dial + briefing + telemetry -->
                <div class="panel">
                  <div class="panel-h">
                    <div class="label">Risk Dial</div>
                    <div class="label" id="tierLabel">—</div>
                  </div>
                  <div class="panel-b">
                    <div class="dialWrap">
                      <div class="dial" id="dial" style="--dialPct:0%; --dialColor:#4caf50;">
                        <div class="dialVal" id="dialVal">—</div>
                      </div>

                      <div class="dialMeta">
                        <div class="tier" id="tierText">Awaiting input…</div>
                        <div class="brief" id="briefText">Enter a ZIP and run analysis to generate a briefing.</div>

                        <div class="facts">
                          <div class="fact"><b>Data Hooks:</b> Census + SVI (scaffold)</div>
                          <div class="fact"><b>Telemetry:</b> simulated route pings</div>
                          <div class="fact"><b>Geofence:</b> radius + polygon demo (scaffold)</div>
                        </div>
                      </div>
                    </div>

                    <div class="toggleRow">
                      <div>
                        <div class="muted"><b>T-24 Briefing</b> (preview toggle)</div>
                        <div class="muted" id="t24State">Off</div>
                      </div>
                      <div class="switch" id="t24Switch" role="switch" aria-checked="false" tabindex="0">
                        <div class="knob"></div>
                      </div>
                    </div>

                    <div style="margin-top:12px;" class="telemetry">
                      <div class="telemetryRow">
                        <span class="tag" id="lifeStateTag">Lifecycle: idle</span>
                        <span class="tag" id="geoStateTag">Geofence: idle</span>
                        <span class="tag" id="telemetryTag">Telemetry: 0%</span>
                      </div>
                      <div class="track"><div class="bar" id="telemetryBar"></div></div>

                      <div class="lifecycle">
                        <div class="lifeBtn" data-life="created" id="lifeCreated">Created</div>
                        <div class="lifeBtn" data-life="enroute" id="lifeEnRoute">En Route</div>
                        <div class="lifeBtn" data-life="complete" id="lifeComplete">Complete</div>
                      </div>
                    </div>

                    <div class="soon" id="reasoningBox" style="margin-top:12px;">
                      <strong>Reasoning blocks</strong><br/><br>
                      Run “Analyze Risk” to populate structured factors.
                    </div>
                  </div>
                </div>

                <!-- Right panel: map -->
                <div class="mapWrap panel">
                  <div class="panel-h">
                    <div class="label">Map Visualization</div>
                    <div class="label">Leaflet • OpenStreetMap</div>
                  </div>
                  <div id="map"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT: Modules (2–4) -->
          <div style="display:grid; gap:18px;">
            <!-- ===== MODULE 02 (REPLACED WITH END-TO-END ORCHESTRATION DEMO) ===== -->
            <section id="module-orchestration" style="margin-top:0;">
              <div class="card" style="padding:18px;border-radius:18px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);">
                <div style="font-size:12px;letter-spacing:.12em;opacity:.7;">MODULE 02 • ORCHESTRATION</div>
                <h2 style="margin:10px 0 6px;font-size:28px;line-height:1.15;">End-to-End Booking</h2>
                <div style="opacity:.75;margin-bottom:14px;">Rideshare + Flights + Hotels orchestration. Demo scaffold returning realistic sample trip objects.</div>

                <!-- Tabs -->
                <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;">
                  <button class="pill active" data-tab="rides" style="padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.10);background:rgba(255,255,255,0.06);color:#fff;cursor:pointer;">Rideshare</button>
                  <button class="pill" data-tab="flights" style="padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.10);background:transparent;color:#fff;cursor:pointer;opacity:.8;">Flights</button>
                  <button class="pill" data-tab="hotels" style="padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.10);background:transparent;color:#fff;cursor:pointer;opacity:.8;">Hotels</button>
                  <button class="pill" data-tab="all" style="padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,0.10);background:transparent;color:#fff;cursor:pointer;opacity:.8;">All</button>
                </div>

                <!-- Input -->
                <div style="display:grid;grid-template-columns:repeat(12,1fr);gap:10px;margin:12px 0 12px;">
                  <div style="grid-column:span 3;">
                    <label style="display:block;font-size:12px;opacity:.7;margin-bottom:6px;">From (City / Airport)</label>
                    <input id="e2eFrom" value="Charlotte (CLT)" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.25);color:#fff;outline:none;" />
                  </div>
                  <div style="grid-column:span 3;">
                    <label style="display:block;font-size:12px;opacity:.7;margin-bottom:6px;">To (City / Airport)</label>
                    <input id="e2eTo" value="New York (JFK)" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.25);color:#fff;outline:none;" />
                  </div>
                  <div style="grid-column:span 2;">
                    <label style="display:block;font-size:12px;opacity:.7;margin-bottom:6px;">Depart</label>
                    <input id="e2eDepart" type="date" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.25);color:#fff;outline:none;" />
                  </div>
                  <div style="grid-column:span 2;">
                    <label style="display:block;font-size:12px;opacity:.7;margin-bottom:6px;">Return</label>
                    <input id="e2eReturn" type="date" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.25);color:#fff;outline:none;" />
                  </div>
                  <div style="grid-column:span 1;">
                    <label style="display:block;font-size:12px;opacity:.7;margin-bottom:6px;">Pax</label>
                    <input id="e2ePax" type="number" min="1" max="6" value="1" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.25);color:#fff;outline:none;" />
                  </div>
                  <div style="grid-column:span 1;">
                    <label style="display:block;font-size:12px;opacity:.7;margin-bottom:6px;">Cabin</label>
                    <select id="e2eCabin" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.10);background:rgba(0,0,0,0.25);color:#fff;outline:none;">
                      <option value="economy">Economy</option>
                      <option value="premium_economy">Prem Econ</option>
                      <option value="business">Business</option>
                      <option value="first">First</option>
                    </select>
                  </div>
                </div>

                <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:10px;">
                  <button id="btnSimulateE2E" style="padding:12px 16px;border-radius:14px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.08);color:#fff;cursor:pointer;font-weight:600;">
                    Simulate Booking Flow
                  </button>
                  <button id="btnCopyTripJSON" style="padding:12px 16px;border-radius:14px;border:1px solid rgba(255,255,255,0.12);background:transparent;color:#fff;cursor:pointer;opacity:.85;">
                    Copy Trip Object JSON
                  </button>
                  <div id="e2eStatus" style="align-self:center;opacity:.75;font-size:13px;"></div>
                </div>

                <!-- Output -->
                <div id="e2eOutput" style="margin-top:16px;display:grid;grid-template-columns:repeat(12,1fr);gap:12px;"></div>
              </div>
            </section>

            <!-- ===== UPDATED TSA CARD (LIVE INPUT + NO COMING SOON + NO PILLS) ===== -->
            <div class="card" id="tsaCard">
              <div class="card-inner">
                <div class="kicker">Module 03 • Airport Intel</div>
                <h2>TSA Wait Times</h2>
                <p>Live PreCheck vs Standard screening visibility via TSA Web Service.</p>

                <div class="form" style="margin-top:14px;">
                  <div class="row">
                    <input type="text" id="tsaAirportInput" placeholder="Airport code (e.g., CLT)" maxlength="3" />
                    <button class="btn btn-primary" type="button" onclick="getTsaWaitTimes()">Get Wait Times</button>
                  </div>
                </div>

                <div id="tsaOutput"></div>

                <div class="actions" style="margin-top:12px;">
                  <button
                    class="btn"
                    type="button"
                    onclick="
                      document.getElementById('tsaAirportInput').value='';
                      document.getElementById('tsaOutput').innerHTML='';
                      document.getElementById('tsaAirportInput').focus();
                    ">
                    Try Another Airport
                  </button>
                  <a class="btn" href="/get-access.html">Join Founding 100 →</a>
                </div>
              </div>
            </div>

            <!-- ===== UPDATED TIER CARD (FUNCTIONAL) ===== -->
            <div class="card" id="tierCard">
              <div class="card-inner">
                <div class="kicker">Module 04 • Personalization</div>

                <div class="title-row">
                  <div>
                    <h2>AI Tier Selector</h2>
                    <p>Describe the trip — get a tier recommendation with rationale (simulated concierge logic).</p>
                  </div>
                </div>

                <p style="margin-top:10px; color: rgba(255,255,255,.78); font-weight:700;">
                  GÖ JET | GÖ BIZZ | G-KLÜB
                </p>

                <div class="form" style="margin-top:12px;">
                  <div class="row">
                    <select id="tierParty" title="Party size">
                      <option value="1" selected>Party size: 1</option>
                      <option value="2">Party size: 2</option>
                      <option value="3">Party size: 3–4</option>
                      <option value="5">Party size: 5+</option>
                    </select>

                    <select id="tierLuggage" title="Luggage">
                      <option value="none" selected>Luggage: none / small bag</option>
                      <option value="carry">Luggage: carry-on</option>
                      <option value="checked">Luggage: 1–2 checked</option>
                      <option value="heavy">Luggage: 3+ / strollers / heavy</option>
                    </select>
                  </div>

                  <div class="row">
                    <select id="tierDistance" title="Trip distance">
                      <option value="short" selected>Distance: local (0–15 mi)</option>
                      <option value="metro">Distance: metro (15–40 mi)</option>
                      <option value="long">Distance: long (40+ mi)</option>
                    </select>

                    <select id="tierTone" title="Trip tone">
                      <option value="efficient" selected>Tone: efficient / on-the-go</option>
                      <option value="client">Tone: client-facing / business</option>
                      <option value="family">Tone: family / multi-stop</option>
                      <option value="vip">Tone: VIP / discreet</option>
                    </select>
                  </div>

                  <div class="row">
                    <select id="tierSecurity" title="Security posture">
                      <option value="normal" selected>Security: standard</option>
                      <option value="aware">Security: elevated awareness</option>
                    </select>

                    <input id="tierNotes" type="text" placeholder="Optional notes (e.g., ‘late arrival’, ‘tight connection’, ‘kids’, ‘high visibility’)" />
                  </div>

                  <div class="actions" style="margin-top:6px;">
                    <button class="btn btn-primary" id="tierRecommendBtn" type="button">Get Recommendation</button>
                    <button class="btn" id="tierResetBtn" type="button">Try Another Scenario</button>
                    <a class="btn" href="/get-access.html">Get early access →</a>
                  </div>
                </div>

                <div id="tierOutput" class="tierOutput" style="margin-top:12px;">
                  <div style="opacity:.8">Enter a scenario and click <b>Get Recommendation</b>.</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <footer>
          © <span id="y"></span> GÖ.AI • <a href="/privacy.html">Privacy</a> • <a href="/terms.html">Terms</a>
        </footer>
      </div>
    </div>
  </div>

  <!-- =========================
    MODULE 02 • ORCHESTRATION (DEMO)
    Script (Self-contained)
  ========================= -->
  <script>
  (() => {
    // ---------- Utilities ----------
    const $ = (id) => document.getElementById(id);

    function pad2(n){ return String(n).padStart(2,'0'); }
    function isoDate(d){
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    }
    function addDays(dateStr, days){
      const d = new Date(dateStr + "T12:00:00");
      d.setDate(d.getDate() + days);
      return isoDate(d);
    }
    function addMinutesToISO(iso, minutes){
      const d = new Date(iso);
      d.setMinutes(d.getMinutes() + minutes);
      return d.toISOString();
    }
    function hhmmFromDate(d){
      return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
    }

    // Deterministic PRNG (mulberry32) for stable "random" demo results per input
    function hashString(str){
      let h = 2166136261;
      for (let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return h >>> 0;
    }
    function mulberry32(a){
      return function(){
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }
    function randInt(rng, min, max){
      return Math.floor(rng() * (max - min + 1)) + min;
    }
    function pick(rng, arr){ return arr[randInt(rng, 0, arr.length-1)]; }
    function money(amount){ return new Intl.NumberFormat(undefined, { style:'currency', currency:'USD' }).format(amount); }

    function token(prefix, rng){
      const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let out = prefix + "_";
      for (let i=0;i<20;i++) out += chars[Math.floor(rng()*chars.length)];
      return out;
    }

    function approxLatLngFor(place, rng){
      const s = place.toLowerCase();
      if (s.includes("charlotte") || s.includes("clt")) return { lat: 35.2271 + (rng()-0.5)*0.04, lng: -80.8431 + (rng()-0.5)*0.04 };
      if (s.includes("new york") || s.includes("jfk") || s.includes("nyc")) return { lat: 40.6413 + (rng()-0.5)*0.04, lng: -73.7781 + (rng()-0.5)*0.04 };
      if (s.includes("san francisco") || s.includes("sfo")) return { lat: 37.6213 + (rng()-0.5)*0.04, lng: -122.3790 + (rng()-0.5)*0.04 };
      if (s.includes("los angeles") || s.includes("lax")) return { lat: 33.9416 + (rng()-0.5)*0.04, lng: -118.4085 + (rng()-0.5)*0.04 };
      return { lat: 37.7749 + (rng()-0.5)*0.5, lng: -122.4194 + (rng()-0.5)*0.5 };
    }

    // ---------- Mock "vendor-shaped" data generators ----------
    function buildTripObject(input, rng){
      const now = Date.now();
      const tripId = "trip_" + Math.floor(now/1000) + "_" + randInt(rng, 1000, 9999);

      const departDate = input.depart;
      const returnDate = input.returnDate;

      const fromLL = approxLatLngFor(input.from, rng);
      const toLL   = approxLatLngFor(input.to, rng);

      // Dummy flight times (stable-ish but variable)
      const departHour = randInt(rng, 6, 12);
      const returnHour = randInt(rng, 14, 20);
      const departMinute = pick(rng, [0, 15, 30, 45]);
      const returnMinute = pick(rng, [0, 10, 20, 30, 40, 50]);

      const flightDepartTimeLocal = `${pad2(departHour)}:${pad2(departMinute)}`;
      const flightReturnTimeLocal = `${pad2(returnHour)}:${pad2(returnMinute)}`;

      // Dummy scheduled ground pickup times: 90–150 min before flight out; 25–60 min after return lands
      const outPickup = new Date(`${departDate}T${flightDepartTimeLocal}:00`);
      outPickup.setMinutes(outPickup.getMinutes() - randInt(rng, 90, 150));
      const pickupOutMs = outPickup.getTime();

      const backPickup = new Date(`${returnDate}T${flightReturnTimeLocal}:00`);
      backPickup.setMinutes(backPickup.getMinutes() + randInt(rng, 25, 60));
      const pickupBackMs = backPickup.getTime();

      return {
        trip_id: tripId,
        created_at_ms: now,
        mode: "demo",
        traveler: { pax: input.pax, cabin_class: input.cabin },
        route: {
          from: { label: input.from, ...fromLL },
          to:   { label: input.to,   ...toLL },
          depart_date: departDate,
          return_date: returnDate
        },
        legs: [
          {
            leg_id: "leg_ground_out",
            type: "ground",
            provider: "rideshare_aggregator",
            dispatch_type: "scheduled",
            pickup_time_ms: pickupOutMs,
            origin: { label: `${input.from} • Pickup`, ...fromLL },
            destination: { label: `${input.from} • Airport`, ...fromLL },
          },
          {
            leg_id: "leg_flight_out",
            type: "flight",
            provider: "duffel_air",
            slices: [{
              origin: input.from.includes("(") ? input.from.split("(")[1].replace(")","").trim() : "CLT",
              destination: input.to.includes("(") ? input.to.split("(")[1].replace(")","").trim() : "JFK",
              departure_date: departDate,
              departure_time: { from: flightDepartTimeLocal }
            }],
          },
          {
            leg_id: "leg_hotel",
            type: "lodging",
            provider: "duffel_stays",
            check_in_date: departDate,
            check_out_date: returnDate,
            rooms: 1,
            guests: [{ type:"adult" }]
          },
          {
            leg_id: "leg_flight_back",
            type: "flight",
            provider: "duffel_air",
            slices: [{
              origin: input.to.includes("(") ? input.to.split("(")[1].replace(")","").trim() : "JFK",
              destination: input.from.includes("(") ? input.from.split("(")[1].replace(")","").trim() : "CLT",
              departure_date: returnDate,
              departure_time: { from: flightReturnTimeLocal }
            }],
          },
          {
            leg_id: "leg_ground_back",
            type: "ground",
            provider: "rideshare_aggregator",
            dispatch_type: "scheduled",
            pickup_time_ms: pickupBackMs,
            origin: { label: `${input.to} • Airport`, ...toLL },
            destination: { label: `${input.to} • Dropoff`, ...toLL },
          }
        ],
        state: {
          lifecycle: "created → planned → quoted_demo",
          can_book: false,
          note: "Demo mode returns vendor-shaped sample objects only."
        }
      };
    }

    function mockRideshareEstimate(leg, rng){
      // Generic rideshare: ties to AI Tier Selector (not vendor names)
      const tiers = [
        { tier_id:"standard", label:"Standard", multiplier: 1.0,  etaMin:[6,14] },
        { tier_id:"executive", label:"Executive", multiplier: 1.6, etaMin:[5,12] },
        { tier_id:"secure", label:"Secure", multiplier: 2.3, etaMin:[8,18] }
      ];

      const base = randInt(rng, 18, 55);
      const surge = 1 + (rng() * 0.5);
      const miles = Math.max(2, Math.round((rng()*18 + 3) * 10) / 10);
      const durationSec = randInt(rng, 600, 2400);

      // Dummy pickup window around scheduled time
      const scheduledISO = new Date(leg.pickup_time_ms).toISOString();
      const windowStart = addMinutesToISO(scheduledISO, -10);
      const windowEnd   = addMinutesToISO(scheduledISO, +10);

      const estimates = tiers.map((t) => {
        const amountCents = Math.round(base * t.multiplier * surge * 100);
        const eta = randInt(rng, t.etaMin[0]*60, t.etaMin[1]*60);
        return {
          tier_id: t.tier_id,
          tier_label: t.label,
          upfront_cost_cents: amountCents,
          currency: "USD",
          pickup_eta_seconds: eta,
          quote_token: token("ride_quote", rng),
          distance_miles: miles,
          duration_seconds: durationSec
        };
      });

      return {
        endpoint_shape: "RIDESHARE/QUOTE (DEMO)",
        start_lat: leg.origin.lat,
        start_lng: leg.origin.lng,
        end_lat: leg.destination.lat,
        end_lng: leg.destination.lng,
        scheduled_pickup_time_ms: leg.pickup_time_ms,
        pickup_window_iso: { start: windowStart, end: windowEnd },
        estimates,
        valid_for_seconds: 120
      };
    }

    function mockDuffelOfferRequest(trip, rng){
      // Duffel: POST /air/offer_requests returns { data: { id, slices, offers, ... } }
      const carriers = [
        { name:"American Airlines", iata:"AA" },
        { name:"Delta Air Lines", iata:"DL" },
        { name:"Southwest Airlines", iata:"WN" }
      ];

      const cabin = trip.traveler.cabin_class;
      const pax = trip.traveler.pax;

      const outSlice = trip.legs.find(l => l.leg_id === "leg_flight_out").slices[0];
      const backSlice = trip.legs.find(l => l.leg_id === "leg_flight_back").slices[0];

      const offerRequestId = "orq_" + randInt(rng, 10000000, 99999999);
      const createdAt = new Date().toISOString();

      function makeOneWayOffer(slice){
        const c = pick(rng, carriers);
        const base = randInt(rng, 120, 540) *
          (cabin === "economy" ? 1 : cabin === "premium_economy" ? 1.35 : cabin === "business" ? 2.2 : 2.9);
        const total = Math.round(base * pax * (1 + rng()*0.18) * 100) / 100;

        // derive times from trip slice time + randomized duration
        const dep = new Date(`${slice.departure_date}T${slice.departure_time.from}:00`);
        const durMin = randInt(rng, 95, 175);
        const arr = new Date(dep.getTime() + durMin*60*1000);

        const flightNo = randInt(rng, 200, 4999);

        return {
          id: "off_" + randInt(rng, 10000000, 99999999),
          live_mode: false,
          total_currency: "USD",
          total_amount: total.toFixed(2),
          expires_at: new Date(Date.now() + 18*60*1000).toISOString(),
          slices: [{
            duration: `PT${Math.floor(durMin/60)}H${pad2(durMin%60)}M`,
            segments: [{
              id: "seg_" + randInt(rng, 10000000, 99999999),
              departing_at: dep.toISOString().slice(0,19),
              arriving_at: arr.toISOString().slice(0,19),
              operating_carrier: {
                name: c.name,
                iata_code: c.iata,
                conditions_of_carriage_url: "https://example.com/conditions"
              },
              operating_carrier_flight_number: String(flightNo),
              cabin_class: cabin
            }]
          }],
          owner: { name: c.name, iata_code: c.iata }
        };
      }

      // Bundle both directions into one "roundtrip-ish" offer
      const offers = Array.from({length: randInt(rng, 2, 4)}).map(() => {
        const out = makeOneWayOffer(outSlice);
        const back = makeOneWayOffer(backSlice);
        const total = (parseFloat(out.total_amount) + parseFloat(back.total_amount)).toFixed(2);
        return {
          id: "off_" + randInt(rng, 10000000, 99999999),
          live_mode: false,
          total_currency: "USD",
          total_amount: total,
          expires_at: new Date(Date.now() + 18*60*1000).toISOString(),
          slices: [ out.slices[0], back.slices[0] ],
          owner: out.owner
        };
      });

      return {
        endpoint_shape: "POST /air/offer_requests",
        data: {
          id: offerRequestId,
          created_at: createdAt,
          live_mode: false,
          cabin_class: cabin,
          slices: [outSlice, backSlice],
          passengers: Array.from({length: pax}).map((_,i)=>({ id:`pas_${i}`, type:"adult" })),
          offers
        }
      };
    }

    function mockDuffelHotelsSearch(trip, rng){
      // Duffel stays-shaped: { data: { results: [...] } }
      const neighborhoods = ["Uptown", "Midtown", "Financial District", "South End", "Downtown"];
      const hotelBrands = [
        { brand:"Hilton", variants:["Hilton", "Hilton Garden Inn", "Conrad"] },
        { brand:"Westin", variants:["The Westin", "Westin Suites"] },
        { brand:"JW Marriott", variants:["JW Marriott", "JW Marriott Grand"] }
      ];

      const checkIn = trip.route.depart_date;
      const checkOut = trip.route.return_date;

      const nights = Math.max(1, Math.round((new Date(checkOut) - new Date(checkIn)) / (1000*60*60*24)));
      const resultCount = randInt(rng, 4, 7);

      const results = Array.from({length: resultCount}).map(() => {
        const b = pick(rng, hotelBrands);
        const name = pick(rng, b.variants) + " " + pick(rng, ["Downtown", "City Center", "Uptown", "Riverside", "Park"]);

        const nightly = randInt(rng, 179, 520);
        const total = nightly * nights;

        return {
          id: "hrr_" + randInt(rng, 10000000, 99999999),
          rooms: 1,
          check_in_date: checkIn,
          check_out_date: checkOut,
          expires_at: new Date(Date.now() + randInt(rng, 10, 40)*60*1000).toISOString(),
          cheapest_rate_currency: "USD",
          cheapest_rate_total_amount: total.toFixed(2),
          accommodation: {
            id: "acc_" + randInt(rng, 10000000, 99999999),
            name,
            brand: b.brand,
            rating: randInt(rng, 3, 5),
            review_score: Math.round((7.9 + rng()*1.8)*10)/10,
            location: {
              address: {
                city_name: trip.route.to.label.replace(/\(.*?\)/g,"").trim(),
                line_one: `${randInt(rng, 10, 999)} ${pick(rng, ["Main St","Market St","Tryon St","Broadway","Park Ave"])}`,
                region: "—",
                country_code: "US",
                postal_code: String(randInt(rng, 10000, 99999))
              }
            },
            highlight: `${pick(rng, neighborhoods)} • ${pick(rng, ["Quiet", "Secure", "Walkable", "Business-ready", "Late check-in"])}`
          }
        };
      }).sort((a,b)=>parseFloat(a.cheapest_rate_total_amount)-parseFloat(b.cheapest_rate_total_amount));

      return {
        endpoint_shape: "POST /stays/search",
        data: {
          created_at: new Date().toISOString(),
          results
        }
      };
    }

    // ---------- Rendering ----------
    function card(title, subtitle, html){
      return `
        <div style="grid-column:span 12;padding:14px;border-radius:16px;background:rgba(0,0,0,0.22);border:1px solid rgba(255,255,255,0.08);">
          <div style="display:flex;align-items:baseline;justify-content:space-between;gap:10px;">
            <div>
              <div style="font-weight:700;font-size:16px;">${title}</div>
              ${subtitle ? `<div style="opacity:.70;font-size:13px;margin-top:2px;">${subtitle}</div>` : ``}
            </div>
          </div>
          <div style="margin-top:10px;opacity:.95;">${html}</div>
        </div>
      `;
    }

    function pre(obj){
      const json = JSON.stringify(obj, null, 2)
        .replace(/[<>&]/g, s => ({'<':'&lt;','>':'&gt;','&':'&amp;'}[s]));
      return `<pre style="margin:0;padding:12px;border-radius:14px;overflow:auto;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);font-size:12px;line-height:1.35;">${json}</pre>`;
    }

    function renderRides(rideOut, rideBack){
      function summarize(est){
        const scheduled = new Date(est.scheduled_pickup_time_ms);
        const scheduledHHMM = hhmmFromDate(scheduled);
        return `
          <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;">
            <div><b>Scheduled</b>: ${scheduledHHMM}</div>
            <div><b>Window</b>: ${new Date(est.pickup_window_iso.start).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}
              – ${new Date(est.pickup_window_iso.end).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</div>
            <div><b>Valid</b>: ${est.valid_for_seconds}s</div>
          </div>
          <div style="margin-top:10px;display:grid;grid-template-columns:repeat(12,1fr);gap:10px;">
            ${est.estimates.map(x => `
              <div style="grid-column:span 4;padding:10px;border-radius:14px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);">
                <div style="font-weight:800;">${x.tier_label}</div>
                <div style="opacity:.8;margin-top:4px;">Upfront: <b>${money(x.upfront_cost_cents/100)}</b></div>
                <div style="opacity:.75;font-size:12px;margin-top:2px;">ETA ~ ${Math.round(x.pickup_eta_seconds/60)} min • ${x.distance_miles} mi</div>
                <div style="opacity:.65;font-size:11px;margin-top:6px;">quote_token: <span style="font-family:monospace;">${x.quote_token}</span></div>
              </div>
            `).join("")}
          </div>
        `;
      }

      return `
        <div style="display:grid;grid-template-columns:repeat(12,1fr);gap:12px;">
          <div style="grid-column:span 12;">
            <div style="opacity:.75;margin-bottom:8px;">Generic rideshare quotes (demo). Tiers map to your AI selector (Standard / Executive / Secure).</div>
          </div>
          <div style="grid-column:span 12;">
            <div style="font-weight:700;margin-bottom:6px;">Outbound</div>
            ${summarize(rideOut)}
          </div>
          <div style="grid-column:span 12;">
            <div style="font-weight:700;margin:14px 0 6px;">Return</div>
            ${summarize(rideBack)}
          </div>
        </div>
      `;
    }

    function renderFlights(duffelAir){
      const offers = duffelAir.data.offers || [];
      const top = offers.slice(0, 3);
      return `
        <div style="opacity:.75;margin-bottom:10px;">Duffel-shaped offer request (quotes only; no Orders).</div>
        <div style="display:grid;grid-template-columns:repeat(12,1fr);gap:10px;">
          ${top.map(o => {
            const owner = o.owner?.name || "Carrier";
            const exp = new Date(o.expires_at).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            return `
              <div style="grid-column:span 4;padding:10px;border-radius:14px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);">
                <div style="font-weight:800;">${money(parseFloat(o.total_amount))}</div>
                <div style="opacity:.8;margin-top:4px;">${owner}</div>
                <div style="opacity:.7;font-size:12px;margin-top:4px;">Expires ~ ${exp}</div>
                <div style="opacity:.65;font-size:11px;margin-top:6px;">offer_id: <span style="font-family:monospace;">${o.id}</span></div>
              </div>
            `;
          }).join("")}
        </div>
        <div style="margin-top:12px;">${pre({ offer_request_id: duffelAir.data.id, cabin_class: duffelAir.data.cabin_class, slice_count: duffelAir.data.slices.length, offer_count: offers.length })}</div>
      `;
    }

    function renderHotels(duffelHotels){
      const results = duffelHotels.data.results || [];
      const top = results.slice(0, 4);
      return `
        <div style="opacity:.75;margin-bottom:10px;">Duffel Stays-shaped search (quotes only; no Booking).</div>
        <div style="display:grid;grid-template-columns:repeat(12,1fr);gap:10px;">
          ${top.map(r => {
            const acc = r.accommodation || {};
            const total = money(parseFloat(r.cheapest_rate_total_amount));
            const exp = new Date(r.expires_at).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            return `
              <div style="grid-column:span 6;padding:10px;border-radius:14px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);">
                <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
                  <div style="font-weight:800;">${acc.name || "Hotel"}</div>
                  <div style="font-weight:800;">${total}</div>
                </div>
                <div style="opacity:.8;margin-top:4px;">${acc.brand ? `<b>${acc.brand}</b> • ` : ""}${acc.highlight || ""}</div>
                <div style="opacity:.7;font-size:12px;margin-top:4px;">Rating ${acc.rating || "—"} • Review ${acc.review_score || "—"}</div>
                <div style="opacity:.65;font-size:11px;margin-top:6px;">result_id: <span style="font-family:monospace;">${r.id}</span> • expires ~ ${exp}</div>
              </div>
            `;
          }).join("")}
        </div>
      `;
    }

    function renderTripSummary(trip){
      const depart = trip.route.depart_date;
      const ret = trip.route.return_date;
      return `
        <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
          <div><b>Trip</b>: ${trip.route.from.label} → ${trip.route.to.label}</div>
          <div><b>Dates</b>: ${depart} → ${ret}</div>
          <div><b>Pax</b>: ${trip.traveler.pax} • <b>Cabin</b>: ${trip.traveler.cabin_class}</div>
          <div><b>Mode</b>: ${trip.mode.toUpperCase()} • <b>Booking</b>: disabled</div>
        </div>
        <div style="margin-top:10px;">${pre(trip)}</div>
      `;
    }

    // ---------- Interaction / State ----------
    let lastTripObject = null;
    let lastBundle = null;
    let activeTab = "rides";

    function setTab(tab){
      activeTab = tab;
      document.querySelectorAll("#module-orchestration .pill").forEach(btn => {
        const isActive = btn.getAttribute("data-tab") === tab;
        btn.classList.toggle("active", isActive);
        btn.style.background = isActive ? "rgba(255,255,255,0.06)" : "transparent";
        btn.style.opacity = isActive ? "1" : ".8";
      });
      paint();
    }

    function getInput(){
      const today = isoDate(new Date());
      const depart = $("e2eDepart").value || addDays(today, 7);
      const returnDate = $("e2eReturn").value || addDays(depart, 2);

      return {
        from: $("e2eFrom").value.trim(),
        to: $("e2eTo").value.trim(),
        depart,
        returnDate,
        pax: Math.max(1, Math.min(6, parseInt($("e2ePax").value || "1", 10))),
        cabin: $("e2eCabin").value
      };
    }

    function simulate(){
      const input = getInput();
      const seed = hashString(`${input.from}|${input.to}|${input.depart}|${input.returnDate}|${input.pax}|${input.cabin}`);
      const rng = mulberry32(seed);

      $("e2eStatus").textContent = "Generating demo trip objects…";

      const trip = buildTripObject(input, rng);

      // Generic rideshare estimates for the two ground legs (round trip)
      const legOut = trip.legs.find(l => l.leg_id === "leg_ground_out");
      const legBack = trip.legs.find(l => l.leg_id === "leg_ground_back");

      const rideOut = mockRideshareEstimate(legOut, rng);
      const rideBack = mockRideshareEstimate(legBack, rng);

      // Flights + hotels
      const duffelAir = mockDuffelOfferRequest(trip, rng);
      const duffelHotels = mockDuffelHotelsSearch(trip, rng);

      const bundle = {
        trip_object: trip,
        quote_run: {
          quote_run_id: "qr_" + randInt(rng, 1000000, 9999999),
          created_at: new Date().toISOString(),
          mode: "demo",
          can_book: false,
          notes: [
            "Rideshare: generic tiers mapped to AI preference selector (no vendor names).",
            "Flights: Duffel-shaped offer_request demo data (no orders).",
            "Hotels: Duffel stays-shaped search demo data (no bookings)."
          ],
          expires_soonest_at: new Date(Math.min(
            Date.now() + 120*1000,
            new Date(duffelAir.data.offers[0]?.expires_at || Date.now() + 18*60*1000).getTime(),
            new Date(duffelHotels.data.results[0]?.expires_at || Date.now() + 18*60*1000).getTime()
          )).toISOString()
        },
        vendors: {
          rideshare: { outbound: rideOut, return: rideBack },
          duffel_air: duffelAir,
          duffel_hotels: duffelHotels
        }
      };

      lastTripObject = trip;
      lastBundle = bundle;

      $("e2eStatus").textContent = "Demo objects ready (quotes simulated; booking disabled).";
      paint();
    }

    function paint(){
      const out = $("e2eOutput");
      if (!out) return;

      if (!lastBundle){
        out.innerHTML = card(
          "Coming soon: route object → vendor calls → confirmations → trip timeline.",
          "This card is intentionally staged as an investor-facing surface.",
          `<div style="opacity:.75;">Click <b>Simulate Booking Flow</b> to generate end-to-end demo objects.</div>`
        );
        return;
      }

      const trip = lastBundle.trip_object;
      const rides = lastBundle.vendors.rideshare;
      const air = lastBundle.vendors.duffel_air;
      const hotels = lastBundle.vendors.duffel_hotels;

      const blocks = [];
      blocks.push(card("Trip Object (Platform)", "Deterministic demo object; drives all downstream quotes.", renderTripSummary(trip)));

      if (activeTab === "rides" || activeTab === "all"){
        blocks.push(card("Rideshare Quotes (Generic)", "Tiers map to your AI selector; includes scheduled windows + quote tokens.", renderRides(rides.outbound, rides.return)));
      }
      if (activeTab === "flights" || activeTab === "all"){
        blocks.push(card("Flight Quotes", "American • Delta • Southwest included in carrier pool (demo).", renderFlights(air)));
      }
      if (activeTab === "hotels" || activeTab === "all"){
        blocks.push(card("Hotel Quotes", "Hilton • Westin • JW Marriott included in hotel pool (demo).", renderHotels(hotels)));
      }

      blocks.push(card("Unified Quote Bundle (Internal)", "What your backend would store for a quote run.", pre(lastBundle.quote_run)));
      out.innerHTML = blocks.join("");
    }

    async function copyTripJSON(){
      if (!lastTripObject){
        $("e2eStatus").textContent = "Run Simulate Booking Flow first.";
        return;
      }
      const text = JSON.stringify(lastTripObject, null, 2);
      try {
        await navigator.clipboard.writeText(text);
        $("e2eStatus").textContent = "Trip Object JSON copied to clipboard.";
      } catch {
        $("e2eStatus").textContent = "Copy failed (clipboard permissions).";
      }
    }

    // ---------- Wire up ----------
    const today = isoDate(new Date());
    if ($("e2eDepart") && $("e2eReturn")){
      $("e2eDepart").value = addDays(today, 7);
      $("e2eReturn").value = addDays(addDays(today, 7), 2);
    }

    $("btnSimulateE2E")?.addEventListener("click", simulate);
    $("btnCopyTripJSON")?.addEventListener("click", copyTripJSON);

    document.querySelectorAll("#module-orchestration .pill").forEach(btn => {
      btn.addEventListener("click", () => setTab(btn.getAttribute("data-tab")));
    });

    setTab("rides");
  })();
  </script>

  <!-- =========================
    EXISTING SCRIPT (SENTINEL / TSA / TIER) — UNCHANGED
  ========================= -->
  <script>
    // Year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Subtle hover glow tracking
    function attachGlowTracking(el){
      el.addEventListener('mousemove', (e) => {
        const r = el.getBoundingClientRect();
        const x = ((e.clientX - r.left) / r.width) * 100;
        const y = ((e.clientY - r.top) / r.height) * 100;
        el.style.setProperty('--mx', x.toFixed(2) + '%');
        el.style.setProperty('--my', y.toFixed(2) + '%');
      }, { passive:true });
    }
    document.querySelectorAll('.card').forEach(attachGlowTracking);

    // ===== Sentinel demo state =====
    let map, marker, geofenceCircle, telemetryLine, polygonDemo;
    let currentZip = null;
    let currentScore = null;
    let currentTier = null;
    let currentLifecycle = "idle";
    let telemetryTimer = null;
    let t24On = false;

    const zipInput = document.getElementById("zipInput");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const radiusSelect = document.getElementById("radiusSelect");

    const dial = document.getElementById("dial");
    const dialVal = document.getElementById("dialVal");
    const tierText = document.getElementById("tierText");
    const tierLabel = document.getElementById("tierLabel");
    const briefText = document.getElementById("briefText");
    const reasoningBox = document.getElementById("reasoningBox");

    const telemetryBar = document.getElementById("telemetryBar");
    const telemetryTag = document.getElementById("telemetryTag");
    const lifeStateTag = document.getElementById("lifeStateTag");
    const geoStateTag = document.getElementById("geoStateTag");

    const lifeCreated = document.getElementById("lifeCreated");
    const lifeEnRoute = document.getElementById("lifeEnRoute");
    const lifeComplete = document.getElementById("lifeComplete");

    const t24Switch = document.getElementById("t24Switch");
    const t24State = document.getElementById("t24State");

    document.getElementById("simCreated").addEventListener("click", () => setLifecycle("created"));
    document.getElementById("simEnRoute").addEventListener("click", () => setLifecycle("enroute"));
    document.getElementById("simComplete").addEventListener("click", () => setLifecycle("complete"));

    lifeCreated.addEventListener("click", () => setLifecycle("created"));
    lifeEnRoute.addEventListener("click", () => setLifecycle("enroute"));
    lifeComplete.addEventListener("click", () => setLifecycle("complete"));

    analyzeBtn.addEventListener("click", () => getRisk());
    zipInput.addEventListener("keydown", (e) => { if (e.key === "Enter") getRisk(); });

    function setLifecycle(state){
      currentLifecycle = state;
      lifeStateTag.textContent = `Lifecycle: ${state}`;
      [lifeCreated, lifeEnRoute, lifeComplete].forEach(b => b.classList.remove("active"));
      if(state === "created") lifeCreated.classList.add("active");
      if(state === "enroute") lifeEnRoute.classList.add("active");
      if(state === "complete") lifeComplete.classList.add("active");

      if(state !== "enroute"){
        stopTelemetry();
        telemetryBar.style.width = "0%";
        telemetryTag.textContent = "Telemetry: 0%";
        geoStateTag.textContent = "Geofence: idle";
      } else {
        if(currentZip && currentScore !== null){
          // re-init map (centers + redraw) and start telemetry
          initMap(currentZip, currentScore);
        }
      }
    }

    function setDial(score){
      const pct = Math.max(0, Math.min(100, score));
      const color =
        pct >= 70 ? "#ffb74d" :
        pct >= 55 ? "#64b5f6" :
        "#4caf50";

      dial.style.setProperty("--dialPct", pct + "%");
      dial.style.setProperty("--dialColor", color);
      dialVal.textContent = pct.toString();
      dial.style.filter = "drop-shadow(0 0 18px rgba(0,0,0,.45))";
      dial.style.transform = "scale(1.01)";
      setTimeout(() => dial.style.transform = "scale(1.0)", 180);
    }

    function renderReasoning(list){
      if(!Array.isArray(list) || !list.length){
        reasoningBox.innerHTML = "<strong>Reasoning blocks</strong><br/>No reasoning blocks returned.";
        return;
      }
      reasoningBox.innerHTML =
        "<strong>Reasoning blocks</strong><br/>" +
        list.map(x => `• ${escapeHtml(x)}`).join("<br/>");
    }

    function tierFromScore(score){
      if(score >= 70) return "ELEVATED";
      if(score >= 55) return "MODERATE";
      return "STANDARD";
    }

    function briefingFromScore(score){
      const t = tierFromScore(score);
      if(t === "ELEVATED") return "SENTINEL recommends minimizing stops, using a single pickup point, and adding buffer time.";
      if(t === "MODERATE") return "SENTINEL recommends normal routing with moderate buffers and awareness of peak windows.";
      return "SENTINEL indicates standard conditions. Keep basic buffers and monitor disruptions.";
    }

    // Toggle: T-24 briefing (UI-only preview)
    function toggleT24(){
      t24On = !t24On;
      t24Switch.classList.toggle("on", t24On);
      t24Switch.setAttribute("aria-checked", t24On ? "true" : "false");
      t24State.textContent = t24On ? "On" : "Off";
      // Soft tweak to briefing output
      if(currentScore !== null){
        const base = briefingFromScore(currentScore);
        briefText.textContent = t24On
          ? base + " (T-24: confirm hotel, route windows, and contingency pickup.)"
          : base;
      }
    }
    t24Switch.addEventListener("click", toggleT24);
    t24Switch.addEventListener("keydown", (e) => { if(e.key === "Enter" || e.key === " ") { e.preventDefault(); toggleT24(); } });

    // ===== UPDATED: ZIP -> lat/lon via Netlify Function =====
    // This assumes you created: netlify/functions/zip-geocode.js
    // and it returns: { zip: "28202", lat: 35.2271, lon: -80.8431, city: "...", state: "..." }
    async function getGeoFromZip(zip){
      const res = await fetch(`/.netlify/functions/zip-geocode?zip=${encodeURIComponent(zip)}`);
      const data = await res.json().catch(() => ({}));
      if(!res.ok){
        throw new Error(data?.error || "Geocode failed");
      }
      if(typeof data.lat !== "number" || typeof data.lon !== "number"){
        throw new Error("Invalid geocode response");
      }
      return data;
    }

    // Map init (uses live geocode now)
    async function initMap(zip, score){
      let geo;
      try{
        geo = await getGeoFromZip(zip);
      } catch(e){
        console.error(e);
        geoStateTag.textContent = "Geofence: geocode error";
        return;
      }

      const lat = geo.lat;
      const lon = geo.lon;

      // Create or recenter map
      if(!map){
        map = L.map("map").setView([lat, lon], 12);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap'
        }).addTo(map);
      } else {
        map.setView([lat, lon], 12);
      }

      // Marker
      if(marker) map.removeLayer(marker);
      marker = L.marker([lat, lon]).addTo(map);

      // Geofence circle radius from selector (meters)
      const radiusMeters = parseInt(radiusSelect.value, 10) || 1600;
      const ringColor =
        score >= 70 ? "#ffb74d" :
        score >= 55 ? "#64b5f6" :
        "#4caf50";

      if(geofenceCircle) map.removeLayer(geofenceCircle);
      geofenceCircle = L.circle([lat, lon], {
        radius: radiusMeters,
        color: ringColor,
        weight: 2,
        fillOpacity: 0.18
      }).addTo(map);

      // Live “polygon demo” (static scaffold)
      if(polygonDemo) map.removeLayer(polygonDemo);
      polygonDemo = L.polygon([
        [lat + 0.018, lon - 0.02],
        [lat + 0.030, lon + 0.005],
        [lat + 0.010, lon + 0.022],
        [lat - 0.010, lon + 0.012],
        [lat - 0.015, lon - 0.010]
      ], {
        color: "rgba(154,215,255,.95)",
        weight: 1,
        fillColor: "rgba(154,215,255,.25)",
        fillOpacity: 0.12
      }).addTo(map);

      geoStateTag.textContent = `Geofence: ${Math.round(radiusMeters/1609.34*10)/10} mi + polygon`;
      // Start telemetry if needed
      if(currentLifecycle === "enroute"){
        simulateTelemetry([lat, lon], score);
      }
    }

    // Telemetry simulation: draws a short line path
    function simulateTelemetry(center, score){
      stopTelemetry();

      let progress = 0;
      const [lat, lon] = center;

      // Build a small loop path
      const pts = [
        [lat, lon],
        [lat + 0.008, lon + 0.006],
        [lat + 0.014, lon - 0.002],
        [lat + 0.006, lon - 0.012],
        [lat - 0.004, lon - 0.006],
        [lat, lon]
      ];

      if(telemetryLine) map.removeLayer(telemetryLine);
      telemetryLine = L.polyline([pts[0]], {
        color: "rgba(241,208,106,.95)",
        weight: 3,
        opacity: 0.9
      }).addTo(map);

      let idx = 0;
      telemetryTimer = setInterval(() => {
        progress = Math.min(100, progress + 7);
        telemetryBar.style.width = progress + "%";
        telemetryTag.textContent = `Telemetry: ${progress}%`;

        idx = Math.min(pts.length-1, idx + 1);
        telemetryLine.addLatLng(pts[idx]);

        // “Entered geofence” simple demo trigger near end if elevated
        if(progress >= 63 && score >= 70){
          geoStateTag.textContent = "Geofence: alert • entered risk polygon";
        }

        if(progress >= 100){
          stopTelemetry();
        }
      }, 320);
    }

    function stopTelemetry(){
      if(telemetryTimer){
        clearInterval(telemetryTimer);
        telemetryTimer = null;
      }
    }

    // Fetch risk score from your existing function
    async function getRisk(){
      const zip = zipInput.value.trim();
      if(!/^\d{5}$/.test(zip)){
        tierLabel.textContent = "—";
        tierText.textContent = "Enter a valid ZIP";
        dialVal.textContent = "—";
        reasoningBox.innerHTML = "<strong>Reasoning blocks</strong><br/>Enter a valid ZIP (5 digits).";
        return;
      }

      analyzeBtn.disabled = true;
      analyzeBtn.textContent = "Analyzing…";
      tierText.textContent = "Running analysis…";
      tierLabel.textContent = "…";

      try{
        const res = await fetch(`/.netlify/functions/sentinel-score?zip=${encodeURIComponent(zip)}`);
        const data = await res.json();

        if(!res.ok || data.error){
          throw new Error(data?.error || "Risk function failed");
        }

        currentZip = zip;
        currentScore = Number(data.risk_score);
        currentTier = data.tier || tierFromScore(currentScore);

        setDial(currentScore);

        tierLabel.textContent = currentTier;
        tierText.textContent = `Risk Tier: ${currentTier}`;
        const baseBrief = data.briefing || briefingFromScore(currentScore);
        briefText.textContent = t24On ? (baseBrief + " (T-24: confirm hotel, route windows, and contingency pickup.)") : baseBrief;

        renderReasoning(data.reasoning || []);

        // UPDATED: map uses zip-geocode function now
        await initMap(zip, currentScore);

        // If in “created” lifecycle, show minimal “ready” state
        if(currentLifecycle === "idle"){
          setLifecycle("created");
        }

      } catch(err){
        console.error(err);
        tierLabel.textContent = "ERROR";
        tierText.textContent = "Error retrieving risk data.";
        reasoningBox.innerHTML = "<strong>Reasoning blocks</strong><br/>Error retrieving risk data.";
        geoStateTag.textContent = "Geofence: error";
      } finally {
        analyzeBtn.disabled = false;
        analyzeBtn.textContent = "Analyze Risk";
      }
    }

    // Safety: escape for HTML injection in reasoning list
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== TSA WAIT TIMES (LIVE) =====
    async function getTsaWaitTimes() {
      const input = document.getElementById("tsaAirportInput");
      const out = document.getElementById("tsaOutput");
      const ap = (input.value || "").trim().toUpperCase();

      if (!/^[A-Z]{3}$/.test(ap)) {
        out.innerHTML = "<p style='opacity:.9;color:#ff6b6b'>Enter a valid 3-letter airport code (e.g., CLT, RDU, JFK).</p>";
        return;
      }

      out.innerHTML = "<p style='opacity:.8'>Fetching TSA wait times…</p>";

      try {
        const res = await fetch(`/.netlify/functions/tsa-wait?airport=${encodeURIComponent(ap)}`);
        const data = await res.json();

        if (!res.ok || data.error) {
          out.innerHTML = `<p style='opacity:.9;color:#ff6b6b'>${data.error || "No data returned."}</p>`;
          return;
        }

        // TSA payloads can vary; handle both {WaitTimes:[...]} and raw arrays safely
        const rows = data.WaitTimes || data.waitTimes || data || [];
        if (!Array.isArray(rows) || rows.length === 0) {
          out.innerHTML = `<p style='opacity:.85'>No confirmed wait times currently published for <strong>${ap}</strong>.</p>`;
          return;
        }

        const top = rows.slice(0, 6).map(x => {
          const checkpoint = x.Checkpoint || x.checkpoint || "Checkpoint";
          const wait = x.WaitTime || x.waitTime || x.Wait || "N/A";
          const category = x.Lane || x.lane || x.Type || "";
          const time = x.Created || x.created || x.Time || "";
          return `<div style="padding:10px 0;border-top:1px solid rgba(255,255,255,.06)">
            <div style="font-weight:700">${checkpoint} <span style="opacity:.7;font-weight:600">${category ? "• " + category : ""}</span></div>
            <div style="opacity:.85">Wait: <strong>${wait}</strong> <span style="opacity:.6">${time ? "• " + time : ""}</span></div>
          </div>`;
        }).join("");

        out.innerHTML = `
          <div style="margin-top:14px">
            <div style="opacity:.85;margin-bottom:8px">Confirmed wait times for <strong>${ap}</strong></div>
            <div style="border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;background:rgba(0,0,0,.18)">
              ${top}
            </div>
          </div>
        `;

      } catch (e) {
        out.innerHTML = "<p style='opacity:.9;color:#ff6b6b'>Error retrieving TSA data. Try again.</p>";
      }
    }

    // ===== Module 04: AI Tier Selector (simulated concierge logic) =====
    (function initTierSelector(){
      const tierParty = document.getElementById("tierParty");
      const tierLuggage = document.getElementById("tierLuggage");
      const tierDistance = document.getElementById("tierDistance");
      const tierTone = document.getElementById("tierTone");
      const tierSecurity = document.getElementById("tierSecurity");
      const tierNotes = document.getElementById("tierNotes");

      const tierRecommendBtn = document.getElementById("tierRecommendBtn");
      const tierResetBtn = document.getElementById("tierResetBtn");
      const tierOutput = document.getElementById("tierOutput");

      if(!tierRecommendBtn || !tierOutput) return;

      const TIER_META = {
        JET: {
          name: "GÖ JET",
          img: "assets/go-jet.png",
          oneLiner: "Fast, reliable point-to-point travel with concierge-managed premium rideshare."
        },
        BIZZ: {
          name: "GÖ BIZZ",
          img: "assets/go-bizz.png",
          oneLiner: "Business-class executive mobility for meetings, client travel, and presentation-forward movement."
        },
        KLUB: {
          name: "G-KLÜB",
          img: "assets/g-klub.png",
          oneLiner: "Luxury SUV concierge tier for VIP travel, executive families, long-distance, and discreet posture."
        }
      };

      function randInt(min, max){
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function scoreScenario(){
        const party = parseInt(tierParty.value, 10) || 1;
        const luggage = tierLuggage.value;
        const dist = tierDistance.value;
        const tone = tierTone.value;
        const sec = tierSecurity.value;
        const notes = (tierNotes.value || "").toLowerCase();

        // Start baseline
        let jet = 10, bizz = 10, klub = 10;

        // Party size
        if(party === 1){
          jet += 10; bizz += 6; klub += 2;
        } else if(party === 2){
          jet += 8; bizz += 8; klub += 4;
        } else if(party === 3){
          jet += 2; bizz += 8; klub += 12;  // 3–4
        } else { // 5+
          jet -= 4; bizz += 4; klub += 18;
        }

        // Luggage
        if(luggage === "none"){
          jet += 8; bizz += 4; klub += 2;
        } else if(luggage === "carry"){
          jet += 6; bizz += 6; klub += 4;
        } else if(luggage === "checked"){
          jet += 2; bizz += 10; klub += 10;
        } else { // heavy
          jet -= 2; bizz += 6; klub += 18;
        }

        // Distance
        if(dist === "short"){
          jet += 10; bizz += 6; klub += 2;
        } else if(dist === "metro"){
          jet += 4; bizz += 10; klub += 8;
        } else { // long
          jet -= 2; bizz += 8; klub += 16;
        }

        // Tone
        if(tone === "efficient"){
          jet += 10; bizz += 6; klub += 2;
        } else if(tone === "client"){
          jet += 2; bizz += 14; klub += 8;
        } else if(tone === "family"){
          jet -= 2; bizz += 6; klub += 16;
        } else { // vip
          jet += 0; bizz += 10; klub += 14;
        }

        // Security posture
        if(sec === "aware"){
          jet += 1; bizz += 6; klub += 14;
        }

        // Notes keyword nudges (optional)
        const hasKids = /kid|kids|child|children|stroller/.test(notes);
        const highVis = /high visibility|vip|press|stalker|threat|unsafe|security/.test(notes);
        const multiStop = /multi|stops|stop|itinerary|route/.test(notes);
        const tight = /tight|connection|late|delay|rush/.test(notes);

        if(hasKids){ klub += 12; bizz += 4; jet -= 1; }
        if(highVis){ klub += 14; bizz += 6; }
        if(multiStop){ klub += 10; bizz += 4; jet -= 2; }
        if(tight){ jet += 6; bizz += 4; klub += 2; }

        // Soft clamp
        jet = Math.max(0, jet);
        bizz = Math.max(0, bizz);
        klub = Math.max(0, klub);

        const scores = [
          { key:"JET", score: jet },
          { key:"BIZZ", score: bizz },
          { key:"KLUB", score: klub },
        ].sort((a,b) => b.score - a.score);

        return { party, luggage, dist, tone, sec, notes, scores };
      }

      function buildRationale(recoKey, ctx){
        // Keep it short + investor-demo readable
        const lines = [];

        if(recoKey === "JET"){
          lines.push("Optimized for speed and clean point-to-point movement.");
          if(ctx.dist !== "short") lines.push("If distance increases, consider BIZZ for comfort and consistency.");
          if(ctx.party >= 3) lines.push("For 3+ passengers, KLÜB typically reduces friction and adds space.");
        }

        if(recoKey === "BIZZ"){
          lines.push("Best balance of presentation, comfort, and availability.");
          if(ctx.tone === "client") lines.push("Client-facing tone favors a business-class posture.");
          if(ctx.luggage === "checked" || ctx.luggage === "heavy") lines.push("Extra space supports luggage-heavy itineraries.");
          if(ctx.sec === "aware") lines.push("If discreet awareness is required, KLÜB is the preferred posture.");
        }

        if(recoKey === "KLUB"){
          lines.push("Max comfort + space for VIP, family, multi-stop, or long-distance scenarios.");
          if(ctx.party >= 3) lines.push("Party size suggests SUV-class logistics and smoother loading/unloading.");
          if(ctx.luggage === "heavy") lines.push("Heavy luggage/strollers strongly favors KLÜB capacity.");
          if(ctx.sec === "aware") lines.push("Elevated awareness aligns with a discreet security-driver posture.");
        }

        // Add a tiny “alive” element (like your risk score demo vibe)
        const buffer = randInt(6, 18);
        lines.push(`Suggested buffer: +${buffer} minutes for curb-to-gate continuity.`);

        return lines;
      }

      function renderTierResult(){
        const ctx = scoreScenario();
        const best = ctx.scores[0];
        const alt1 = ctx.scores[1];
        const alt2 = ctx.scores[2];

        const meta = TIER_META[best.key];
        const rationale = buildRationale(best.key, ctx);

        const now = new Date();
        const hh = String(now.getHours()).padStart(2,"0");
        const mm = String(now.getMinutes()).padStart(2,"0");
        const stamp = `${hh}:${mm}`;

        const badges = [];
        badges.push({ text: `Party: ${ctx.party === 3 ? "3–4" : ctx.party === 5 ? "5+" : ctx.party}`, gold:false });
        badges.push({ text: `Distance: ${ctx.dist}`, gold:false });
        badges.push({ text: `Luggage: ${ctx.luggage}`, gold:false });
        if(ctx.sec === "aware") badges.push({ text: "Elevated awareness", gold:true });
        if(ctx.tone === "vip") badges.push({ text: "VIP posture", gold:true });
        if(ctx.tone === "client") badges.push({ text: "Client-facing", gold:true });
        if(ctx.tone === "family") badges.push({ text: "Family logistics", gold:true });

        tierOutput.innerHTML = `
          <div class="tierOutHead">
            <div class="label">Recommendation</div>
            <div class="label">Simulated • ${stamp}</div>
          </div>

          <div class="tierOutBody">
            <div class="tierHero">
              <div class="tierImg">
                <img src="${meta.img}" alt="${meta.name}"/>
              </div>

              <div style="min-width:0;">
                <div class="tierTitle">${meta.name}</div>
                <div class="tierSub">${escapeHtml(meta.oneLiner)}</div>

                <div class="tierBadges">
                  ${badges.slice(0,6).map(b => `<span class="badge ${b.gold ? "gold":""}">${escapeHtml(b.text)}</span>`).join("")}
                </div>
              </div>
            </div>

            <div style="color: rgba(255,255,255,.76); font-size:13px; line-height:1.6;">
              <b>Why:</b><br/><br>
              ${rationale.map(x => `• ${escapeHtml(x)}`).join("<br/>")}
            </div>

            <div class="altRow">
              <span><b>Alternates:</b></span>
              <span class="badge">${TIER_META[alt1.key].name}</span>
              <span class="badge">${TIER_META[alt2.key].name}</span>
              <span style="opacity:.65;">(demo ranking)</span>
            </div>
          </div>
        `;
      }

      function resetTier(){
        tierParty.value = "1";
        tierLuggage.value = "none";
        tierDistance.value = "short";
        tierTone.value = "efficient";
        tierSecurity.value = "normal";
        tierNotes.value = "";
        tierOutput.innerHTML = `<div style="opacity:.8">Enter a scenario and click <b>Get Recommendation</b>.</div>`;
      }

      tierRecommendBtn.addEventListener("click", renderTierResult);
      tierResetBtn.addEventListener("click", resetTier);

      // Optional: allow Enter key in notes to run
      tierNotes.addEventListener("keydown", (e) => {
        if(e.key === "Enter"){
          e.preventDefault();
          renderTierResult();
        }
      });
    })();
  </script>
</body>
</html>
